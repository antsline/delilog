# delilog MVP開発計画書

## 概要

本計画書は、delilogのMVP（Phase 1）開発を12週間で完了させるための詳細な開発計画です。各週・各日の作業内容と成果物を明確にし、段階的に動作確認可能な形で進めます。

## 開発環境・技術スタック

- **フレームワーク**: Expo (SDK 50)
- **言語**: TypeScript
- **バックエンド**: Supabase
- **状態管理**: Zustand
- **UI**: NativeWind (Tailwind CSS for React Native)
- **フォーム**: React Hook Form
- **ナビゲーション**: Expo Router
- **PDF生成**: react-native-pdf

## Week 1: プロジェクトセットアップと認証基盤

### Day 1-2: 開発環境構築

**作業内容:**

- Expoプロジェクトの初期化
- TypeScript設定
- ESLint/Prettier設定
- 基本的なディレクトリ構造の作成

```
/app
  /(auth)
  /(tabs)
/components
/hooks
/services
/store
/types
/utils
```

**成果物:**

- 動作する空のExpoアプリ
- 開発環境のREADME.md

### Day 3-4: Supabase設定と認証UI

**作業内容:**

- Supabaseプロジェクト作成
- 認証スキーマ設定
- ログイン画面UI実装（Apple/Google/SMS認証ボタン）
- NativeWind導入とテーマ設定

**成果物:**

- 認証画面のUI（機能はまだ）
- カラーテーマの確定

### Day 5-7: 認証機能実装

**作業内容:**

- Apple認証の実装
- Google認証の実装
- SMS認証の実装
- 初回登録フロー（屋号、運転者名、車両番号）

**動作確認:**

- 各認証方法でログイン可能
- 初回登録情報がSupabaseに保存される

## Week 2: データベース設計とホーム画面

### Day 8-9: データベース構築

**作業内容:**

- Supabaseでテーブル作成
  - users（拡張プロフィール）
  - vehicles（車両情報）
  - tenko_records（点呼記録）
- Row Level Security設定
- TypeScript型定義生成

**成果物:**

- マイグレーションファイル
- 型定義ファイル

### Day 10-11: ホーム画面UI

**作業内容:**

- タブナビゲーション設定
- ホーム画面レイアウト
- 業務前/業務後点呼ボタン
- 今日のステータス表示

**成果物:**

- ナビゲーション可能なアプリ
- ホーム画面のモックアップ状態

### Day 12-14: 状態管理とデータ連携

**作業内容:**

- Zustandストア設定
- ユーザー情報の取得・表示
- 今日の点呼記録の取得
- リアルタイム更新の設定

**動作確認:**

- ログイン後、ユーザー名が表示される
- 今日の点呼状態が正しく表示される

## Week 3: 点呼記録機能（業務前）

### Day 15-16: 業務前点呼画面UI

**作業内容:**

- 点呼記録フォームのレイアウト
- 各入力項目のコンポーネント作成
- デフォルト値の設定

**成果物:**

- 完成した業務前点呼画面（静的）

### Day 17-18: フォーム制御とバリデーション

**作業内容:**

- React Hook Form導入
- バリデーションルール設定
- エラー表示UI
- 音声入力対応（特記事項）

**動作確認:**

- フォームの入力・バリデーションが動作
- 音声入力が可能

### Day 19-21: データ保存とフィードバック

**作業内容:**

- Supabaseへのデータ保存実装
- 保存成功/失敗のフィードバック
- ローディング状態の実装
- ホーム画面への反映

**動作確認:**

- 業務前点呼を記録できる
- 記録後、ホーム画面のステータスが更新される

## Week 4: 点呼記録機能（業務後）と設定画面

### Day 22-23: 業務後点呼実装

**作業内容:**

- 業務前点呼をベースに業務後点呼画面作成
- 業務後特有の項目対応
- データ保存処理

**動作確認:**

- 業務後点呼を記録できる
- 1日の記録が完了状態になる

### Day 24-25: 車両管理機能

**作業内容:**

- 設定画面のタブ追加
- 車両一覧表示
- 車両追加/編集/削除機能
- デフォルト車両設定

**成果物:**

- 車両を3台まで登録可能
- 点呼記録で車両を選択できる

### Day 26-28: プロフィール編集

**作業内容:**

- 基本情報編集画面
- データ更新処理
- アプリ情報・ライセンス表示

**動作確認:**

- 設定変更が各画面に反映される
- 基本的な設定機能が完成

## Week 5: 記録一覧画面

### Day 29-30: 一覧画面の基本実装

**作業内容:**

- カレンダー型の月表示
- 日付ごとのカード表示
- 記録データの取得処理

**成果物:**

- 当月の記録が表示される画面

### Day 31-32: 一覧画面の詳細機能

**作業内容:**

- 記録状態のアイコン表示（完了/未完了/運行なし）
- 土日祝日の色分け
- 月送り/戻り機能
- スクロール最適化

**動作確認:**

- 複数月のデータを閲覧できる
- パフォーマンスが良好

### Day 33-35: 記録の編集機能

**作業内容:**

- 過去の記録をタップして編集
- 運行なしの登録機能
- 削除機能（確認ダイアログ付き）

**動作確認:**

- 過去の記録を修正できる
- データの整合性が保たれる

## Week 6: PDF生成機能

### Day 36-37: PDF生成の基本実装

**作業内容:**

- react-native-pdf導入
- 国交省フォーマットのテンプレート作成
- 週単位でのデータ取得処理

**成果物:**

- PDFが生成される（内容はまだ不完全）

### Day 38-39: PDFレイアウト完成

**作業内容:**

- 点呼記録簿の正確なレイアウト実装
- 日本語フォント対応
- 空欄の適切な処理

**動作確認:**

- 国交省フォーマットに準拠したPDFが生成される

### Day 40-42: PDF出力機能の完成

**作業内容:**

- PDFプレビュー画面
- 保存機能
- 共有機能（シェアシート）
- コンビニプリント説明画面

**動作確認:**

- PDFを保存・共有できる
- コンビニで印刷可能な形式

## Week 7: オフライン対応とデータ同期

### Day 43-44: オフラインストレージ

**作業内容:**

- AsyncStorageでのローカル保存
- オフライン時の記録機能
- 同期状態の管理

**成果物:**

- オフラインでも基本機能が使える

### Day 45-46: データ同期処理

**作業内容:**

- オンライン復帰時の自動同期
- 競合解決ロジック
- 同期状態のUI表示

**動作確認:**

- オフライン→オンラインでデータが同期される
- データの欠損がない

### Day 47-49: エラーハンドリング強化

**作業内容:**

- 各種エラーケースの洗い出し
- エラー時のフォールバック処理
- ユーザーへの適切なフィードバック

**動作確認:**

- ネットワークエラー時も適切に動作
- データ不整合が発生しない

## Week 8: パフォーマンス最適化とUX改善

### Day 50-51: パフォーマンス計測と改善

**作業内容:**

- React Native Performance Monitor導入
- ボトルネックの特定
- メモ化・最適化の実施

**成果物:**

- 起動時間3秒以内達成
- スムーズなスクロール

### Day 52-53: UXブラッシュアップ

**作業内容:**

- ローディング表示の統一
- アニメーションの追加
- フィードバックの改善
- キーボード制御の最適化

**動作確認:**

- 操作感が心地よい
- レスポンスが早い

### Day 54-56: アクセシビリティ対応

**作業内容:**

- VoiceOver/TalkBack対応
- 適切なラベル付け
- コントラスト比の確認
- フォントサイズの調整機能

**動作確認:**

- アクセシビリティツールで問題なし
- 様々な環境で使いやすい

## Week 9: プッシュ通知とリマインダー

### Day 57-58: プッシュ通知基盤

**作業内容:**

- Expo Notificationsセットアップ
- 通知許可の取得フロー
- デバイストークンの管理

**成果物:**

- 通知許可が取得できる
- テスト通知が送信できる

### Day 59-60: リマインダー機能

**作業内容:**

- 点呼忘れ防止通知
- 設定画面での通知管理
- 通知時間のカスタマイズ

**動作確認:**

- 指定時間に通知が届く
- 通知から app が起動する

### Day 61-63: バックグラウンド処理

**作業内容:**

- バックグラウンドでの通知スケジューリング
- 記録状態のチェック処理
- 省電力対応

**動作確認:**

- アプリを閉じても通知が届く
- バッテリー消費が適切

## Week 10: セキュリティとデータ保護

### Day 64-65: セキュリティ強化

**作業内容:**

- 生体認証の実装（オプション）
- セキュアストレージの利用
- 通信の暗号化確認

**成果物:**

- 機密データが適切に保護される

### Day 66-67: プライバシー対応

**作業内容:**

- プライバシーポリシー画面
- データ削除機能
- GDPR対応の基礎

**動作確認:**

- ユーザーデータの管理が適切
- 法的要件を満たす

### Day 68-70: バックアップとリストア

**作業内容:**

- データエクスポート機能
- アカウント削除時の処理
- データ移行の仕組み

**動作確認:**

- データのバックアップが可能
- アカウント削除が完全に機能

## Week 11: 決済機能とサブスクリプション

### Day 71-72: アプリ内課金の準備

**作業内容:**

- RevenueCat SDK導入
- 商品設定（月額980円）
- サンドボックステスト環境

**成果物:**

- 課金フローの基礎が完成

### Day 73-74: サブスクリプション画面

**作業内容:**

- 料金プラン表示画面
- 無料トライアル案内
- 購入フローUI

**動作確認:**

- テスト環境で購入可能
- 購入状態が反映される

### Day 75-77: 課金状態の管理

**作業内容:**

- サブスクリプション状態の同期
- 機能制限の実装
- レシート検証

**動作確認:**

- 無料/有料で機能差がある
- 更新が自動処理される

## Week 12: テストとリリース準備

### Day 78-79: 自動テスト整備

**作業内容:**

- Jest設定
- 主要機能のユニットテスト
- 統合テストの作成

**成果物:**

- テストカバレッジ70%以上
- CI/CDパイプライン

### Day 80-81: 手動テストとバグ修正

**作業内容:**

- 全機能の手動テスト
- 各種端末での動作確認
- バグ修正

**動作確認:**

- 致命的なバグがない
- 主要機能が安定動作

### Day 82-84: リリース準備

**作業内容:**

- App Store/Google Play申請準備
- スクリーンショット作成
- 説明文の作成
- プライバシーポリシー準備

**成果物:**

- 申請可能な状態のアプリ
- 完全なドキュメント

## 開発における重要な指針

### コミット規則

```
feat: 新機能追加
fix: バグ修正
docs: ドキュメント更新
style: フォーマット修正
refactor: リファクタリング
test: テスト追加・修正
chore: ビルド設定など
```

### ブランチ戦略

- main: 本番環境
- develop: 開発環境
- feature/\*: 機能開発
- hotfix/\*: 緊急修正

### 日次の進捗確認項目

1. 実装した機能のスクリーンショット
2. 動作確認のチェックリスト
3. 発生した課題と解決策
4. 翌日の作業予定

### 週次のマイルストーン確認

1. 計画との差異分析
2. リスクの洗い出し
3. 次週の優先順位調整
4. ステークホルダーへの報告

## リスクと対策

### 技術的リスク

- **Expo制限への対処**: Ejectが必要な場合は早期判断
- **PDF生成の複雑さ**: Week 6で集中対応、必要なら外部ライブラリ検討
- **オフライン同期**: Week 7で十分なテスト時間確保

### スケジュールリスク

- **バッファ時間**: 各週に1-2日の予備日を設定
- **優先順位**: コア機能を先に、追加機能は後回し可
- **並行作業**: 可能な限りUIとロジックを分離して並行開発

## 成功基準

1. 全ての基本機能が動作する
2. App Store/Google Playの審査基準を満たす
3. 起動から記録完了まで30秒以内
4. クラッシュ率0.1%以下
5. オフラインでも基本機能が使える
